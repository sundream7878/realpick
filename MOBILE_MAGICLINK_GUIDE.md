# 📱 모바일 매직링크 로그인 가이드

## 🚨 "매직링크가 만료되었습니다" 에러

### 가장 흔한 원인

#### 1️⃣ **이미 링크를 한 번 사용함** (가장 흔함!)
```
매직링크는 한 번만 사용 가능합니다.
같은 링크를 다시 클릭하면 만료 에러가 발생합니다.
```

**해결방법:**
- ✅ 새로운 매직링크를 요청하세요
- ⚠️ 링크를 여러 번 클릭하지 마세요

---

#### 2️⃣ **실제로 시간이 지남** (1시간 제한)
```
매직링크는 발송 후 1시간 동안만 유효합니다.
(이전 설정: 24시간 → 현재: 1시간)
```

**해결방법:**
- ✅ 이메일을 받으면 바로 클릭하세요
- ✅ 1시간이 지났다면 새로 요청하세요

---

#### 3️⃣ **모바일 앱에서 링크가 잘림**
```
일부 이메일 앱에서 긴 URL을 잘라버립니다.
→ token_hash가 불완전하면 만료 에러 발생
```

**해결방법:**
- ✅ 기본 브라우저(Safari/Chrome)에서 열기
- ✅ 이메일 앱 → "브라우저에서 열기" 선택
- ❌ Gmail/Naver 앱 내부 브라우저는 피하세요

---

## ✅ 모바일에서 성공적으로 로그인하는 방법

### 단계별 가이드

#### 📧 Step 1: 이메일 요청
```
1. 모바일 브라우저에서 realpick.netlify.app 접속
2. "로그인" 버튼 클릭
3. 이메일 입력
4. "매직링크 받기" 클릭
```

#### ⏰ Step 2: 즉시 확인 (1시간 이내!)
```
1. 이메일 앱 열기
2. RealPick 이메일 확인
3. ⚠️ 5분 이내에 클릭 권장
```

#### 🔗 Step 3: 올바르게 열기
```
✅ 좋은 방법:
- "브라우저에서 열기" 선택
- Safari/Chrome에서 직접 열기
- 링크 길게 누르기 → "Safari로 열기"

❌ 나쁜 방법:
- 이메일 앱 내부 브라우저
- 여러 번 클릭
- 다른 탭에서 동시에 열기
```

#### ✨ Step 4: 로그인 완료
```
1. 자동으로 로그인 처리 (1-3초 대기)
2. "인증 처리 중..." 메시지 표시
3. 홈 화면으로 이동
```

---

## 🔧 트러블슈팅

### 문제 1: "이미 사용된 링크입니다"
```
원인: 링크를 두 번 이상 클릭했습니다.
```

**해결:**
1. 새 매직링크 요청
2. 이번에는 딱 한 번만 클릭
3. 로딩이 느려도 기다리세요

---

### 문제 2: "매직링크가 만료되었습니다"
```
원인: 1시간이 지났거나 링크가 잘렸습니다.
```

**해결:**
1. 이메일 수신 시간 확인
2. 1시간 이내라면: 브라우저에서 다시 열기
3. 1시간 지났다면: 새 링크 요청

---

### 문제 3: "링크를 찾을 수 없습니다"
```
원인: URL이 완전히 복사되지 않았습니다.
```

**해결:**
1. 이메일에서 링크 길게 누르기
2. "링크 복사" 선택
3. Safari/Chrome 열기
4. 주소창에 붙여넣기
5. 전체 URL이 보이는지 확인

---

### 문제 4: 계속 로딩 중...
```
원인: 모바일 네트워크가 느립니다.
```

**해결:**
1. 최대 3초까지 기다리세요 (자동 재시도 3번)
2. Wi-Fi 연결 확인
3. 그래도 안 되면 페이지 새로고침
4. 새 매직링크 요청

---

## 📱 모바일별 권장 설정

### iOS (iPhone/iPad)

#### ✅ 권장 브라우저:
- **Safari** (기본 브라우저)
- Chrome
- Edge

#### ⚙️ 설정:
```
설정 > Safari > 개인정보 보호
- "사이트 간 추적 방지" 끄기 (선택사항)
- "모든 쿠키 차단" 끄기 (필수!)
```

#### 📧 이메일 앱:
```
✅ 좋음: 기본 메일 앱
⚠️ 주의: Gmail 앱 → "브라우저에서 열기" 사용
❌ 피함: Naver 메일 앱 내부 브라우저
```

---

### Android

#### ✅ 권장 브라우저:
- **Chrome** (기본 브라우저)
- Samsung Internet
- Firefox

#### ⚙️ 설정:
```
설정 > Chrome > 사이트 설정
- 쿠키: "허용" 설정
- JavaScript: "허용" 설정
```

#### 📧 이메일 앱:
```
✅ 좋음: Gmail 앱 → "브라우저에서 열기"
✅ 좋음: 기본 이메일 앱
❌ 피함: 앱 내부 브라우저
```

---

## 🎯 체크리스트

로그인 전 확인:

- [ ] 이메일을 받은 지 **1시간 이내**인가요?
- [ ] 링크를 **처음 클릭**하는 건가요?
- [ ] **기본 브라우저**(Safari/Chrome)에서 여나요?
- [ ] 쿠키가 **허용**되어 있나요?
- [ ] **안정적인 인터넷** 연결인가요?

모두 체크되었다면 로그인이 성공합니다! ✅

---

## 💡 Pro Tips

### Tip 1: 빠른 로그인
```
1. 이메일 앱에서 알림 오면
2. 바로 클릭 (5분 이내)
3. 한 번만 클릭
4. 3초 대기
5. 완료!
```

### Tip 2: 링크 저장 금지
```
❌ 북마크에 저장하지 마세요
❌ 다른 사람에게 공유하지 마세요
❌ 나중에 사용하려고 하지 마세요

매직링크는:
- 한 번만 사용 가능
- 1시간만 유효
- 본인만 사용 가능
```

### Tip 3: 여러 디바이스
```
✅ PC에서 요청 → PC에서 클릭 (OK)
✅ 모바일에서 요청 → 모바일에서 클릭 (OK)
⚠️ PC에서 요청 → 모바일에서 클릭 (OK, 하지만 느릴 수 있음)
```

---

## 🔐 보안 안내

### 매직링크가 안전한 이유:
- ✅ 비밀번호 불필요
- ✅ 한 번만 사용 가능
- ✅ 1시간 후 자동 만료
- ✅ 이메일 접근 권한 필요

### 주의사항:
- ⚠️ 의심스러운 이메일 주의
- ⚠️ realpick.netlify.app 도메인 확인
- ⚠️ 요청하지 않은 링크는 클릭 금지

---

## 📞 여전히 안 되나요?

### 다음 정보를 확인해주세요:

1. **브라우저 콘솔 로그**
   - Safari: 설정 > 고급 > 웹 속성 검사기
   - Chrome: 메뉴 > 도구 > 개발자 도구

2. **에러 메시지 전체 복사**
   - 화면에 나타난 에러 메시지
   - 빨간색으로 표시된 내용

3. **이메일 링크 복사**
   - 전체 URL 복사
   - 개인정보 부분만 가리기

4. **시간 정보**
   - 이메일 받은 시간
   - 클릭한 시간
   - 시도한 횟수

---

## ✨ 코드 개선사항 (v2.0)

### 새로운 기능:
- ✅ 모바일 감지 및 최적화
- ✅ 3번 자동 재시도 (500ms, 1s, 1.5s)
- ✅ 친화적인 에러 메시지
- ✅ 디바이스별 로깅

### 만료 시간:
```
Supabase 기본값: 1시간
- 이메일 발송 후 60분간 유효
- 보안을 위해 짧게 설정됨
```

---

## 🎉 성공하면 이렇게 보입니다

### 콘솔 로그 (성공):
```javascript
[handleMagicLinkCallback] 시작
[handleMagicLinkCallback] 대기 중... (500ms, 시도 1/3)
[handleMagicLinkCallback] 세션 발견! (1번째 시도)
[handleMagicLinkCallback] 매직링크로 세션 생성 성공
[handleMagicLinkCallback] 디바이스 정보: { isMobile: true }
✅ 로그인 완료!
```

### 화면 표시:
```
"인증 처리 중..." (1-3초)
↓
"로그인 성공!" 또는 자동으로 홈 화면 이동
```

---

**모바일에서도 완벽하게 작동합니다! 🚀**

문제가 계속되면 위의 체크리스트를 다시 확인하거나
새 매직링크를 요청해주세요!

