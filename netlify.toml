[build]
  command = "npm install --legacy-peer-deps && npm run build"
  # 마케팅 봇 폴더 변경 시 재빌드 하지 않음 (로컬 전용)
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF -- . ':!realpick-marketing-bot'"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--production=false"

# API 라우트 캐싱 방지
[[headers]]
  for = "/api/*"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0"
    Pragma = "no-cache"
    Expires = "0"

# 마케팅 API 접근 차단 (로컬 전용)
[[headers]]
  for = "/api/admin/marketer/*"
  [headers.values]
    X-Robots-Tag = "noindex"
    
[[redirects]]
  from = "/api/admin/marketer/*"
  to = "/404"
  status = 404
  force = true