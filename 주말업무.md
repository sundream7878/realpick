<1> 마감 -진행중  불일치

원인을 찾았고 수정했습니다!
문제는 "마감" 배지의 의미가 달랐던 것입니다.

사용자님 생각: "마감" 배지 = "미션이 끝났다(Closed)"
기존 코드: "마감" 배지 = "결과는 마감 후에 공개된다(Reveal after deadline)"
즉, 미션은 진행중인데, 결과 공개 방식이 "마감 후 공개"라서 **"마감"**이라는 배지가 붙어 있었던 것입니다. 이것이 오해를 불러일으켰습니다.

수정 내용:

"진행중" 배지 추가: 이제 상세 페이지에서도 홈 화면처럼 "진행중" (파란색) 또는 "마감됨" (회색) 배지가 명확하게 표시됩니다.
오해 소지 배지 제거: "마감"이라고만 써있던 배지를 없애고, 실시간 결과 공개인 경우에만 **"실시간 결과"**라고 표시하도록 바꿨습니다.
남은 시간 표시: 커플 매칭 미션에서도 마감일이 남아있다면 **남은 시간(D-Day)**을 표시하도록 개선했습니다.
이제 상세 페이지에 들어가셔도 **"진행중"**이라고 정상적으로 나올 것입니다. 확인 부탁드립니다!

<2> 매직링크 보완
매직링크 로그인 문제를 해결하기 위해 두 가지 중요한 수정을 적용했습니다.

다른 브라우저/기기 로그인 문제 해결:
원인: 기존에는 보안 강화 방식(PKCE)을 사용했는데, 이 방식은 '로그인을 요청한 브라우저'와 '링크를 클릭한 브라우저'가 같아야만 인증이 완료됩니다. 그래서 PC에서 요청하고 폰에서 클릭하면 실패했던 것입니다.
해결: Supabase 클라이언트 설정에 flowType: 'implicit' 옵션을 추가했습니다. 이제 이메일 링크에 인증 토큰이 직접 포함되어 오므로, 어떤 브라우저나 기기에서 링크를 클릭해도 즉시 로그인이 가능해집니다.
원래 탭 로그인 동기화 (새 탭만 로그인되는 문제):
원인: 링크를 클릭해 새 탭에서 로그인이 완료되었을 때, 기존에 열려있던 탭이 이를 즉시 감지하지 못하는 경우가 있었습니다.
해결: 로그인 완료 시점에 강제로 동기화 신호(rp_auth_sync)를 보내도록 코드를 추가했습니다. 이제 새 탭에서 로그인이 완료되면, 기존에 열려있던 탭도 자동으로 로그인 상태로 새로고침됩니다. (단, 같은 브라우저일 경우에만 해당됩니다. PC 탭과 모바일 앱 간의 실시간 동기화는 웹소켓 등 별도 구현이 필요합니다.)
이제 Accept All을 하시고 다시 테스트해보시면, PC에서 요청하고 모바일에서 클릭해도 로그인이 잘 되고, 원래 열려있던 탭도 로그인 상태로 변하는 것을 확인하실 수 있을 것입니다!


<3> 등급 로드맵
2컬럼 레이아웃 적용:
왼쪽 (메인): 1등급(픽마스터)부터 7등급(루키)까지의 전체 등급 리스트를 보여줍니다.
다음 등급 목표: 현재 점수와 다음 등급까지 남은 점수를 보여주는 프로그레스 바를 상단에 배치하여 동기부여를 높였습니다.
등급 리스트: 각 등급의 캐릭터, 이름, 필요 점수, 그리고 간단한 설명을 카드 형태로 나열했습니다.
내 위치 강조: 현재 내 등급은 크기를 키우고 테두리와 "MY" 뱃지로 강조했습니다.
달성 현황: 이미 달성한 하위 등급은 은은하게, 아직 달성하지 못한 상위 등급은 잠금 느낌으로 표현하여 성취감을 줍니다.
오른쪽 (사이드): 기존의 내 프로필 정보를 이동시켰습니다.
스크롤을 내려도 항상 보이도록 Sticky 기능을 적용하여 편의성을 높였습니다.
이제 프로필 페이지에서 나의 현재 위치와 앞으로의 목표를 한눈에 파악하실 수 있습니다. 확인해 보세요! ✨


<4> 티어 캐릭터 아바타 중복 코드 정리

**문제 상황:**
프로필 이미지 업로드 기능을 제거하는 과정에서 심각한 코드 중복 문제를 발견했습니다.

**발견된 문제점:**
1. **불필요한 State 관리**: 모든 페이지(page.tsx, p-mypage, p-missions, p-mission/vote, p-mission/results)에서 `userAvatarUrl` state를 개별적으로 선언하고 관리
2. **중복된 Props 전달**: `AppHeader` → `UserInfo`로 `avatarUrl`을 매번 전달
3. **DB 조회 낭비**: 각 페이지에서 `user.avatarUrl`을 가져오지만 실제로는 사용하지 않음
4. **불필요한 조건문**: `avatarUrl || tier.characterImage` 같은 조건문이 모든 컴포넌트에 산재

**근본 원인:**
- `userTier` 객체에 이미 `characterImage`가 포함되어 있음
- 티어 캐릭터만 사용하면 되는데, 커스텀 아바타 기능을 위한 코드가 전체 앱에 퍼져있었음

**수정 내용:**
1. ✅ DB 스키마: `users.avatar_url` 컬럼 제거 (마이그레이션 v18)
2. ✅ 타입 정의: `TUser.avatarUrl` 필드 제거
3. ✅ 백엔드 함수: `getUser`, `createUser`, `updateUserProfile` 등에서 avatarUrl 매핑 제거
4. ✅ 컴포넌트: `AppHeader`, `UserInfo`에서 avatarUrl props 제거
5. ✅ 모든 페이지: `userAvatarUrl` state 및 관련 코드 제거
6. ✅ 프로필 페이지: 프로필 이미지 업로드 UI(카메라 아이콘) 제거

**최종 구조:**
```typescript
// 간단하고 명확한 구조
<UserInfo tier={userTier} />  // tier.characterImage 자동 사용
```

**교훈:**
- 기능 추가 시 중복 코드를 최소화하는 설계 필요
- 컴포넌트 계층에서 데이터는 한 곳에서만 관리
- 불필요한 state는 즉시 제거


<5> 메인 헤더 메뉴 시스템 구축

**구현 내용:**
프로그램 카테고리별 드롭다운 메뉴 시스템을 구축했습니다.

**3대 메인 메뉴:**
1. **❤️ LOVE (로맨스)** - 나는 SOLO, 나솔사계, 돌싱글즈6, 솔로지옥 시즌4, 끝사랑, 환승연애, 투제니, 연애남매 (8개)
2. **🏆 VICTORY (승부/생존)** - 최강야구, 골 때리는 그녀들, 강철부대W, 피의 게임 3, 대학전쟁 시즌2, 흑백요리사 시즌2, 뭉쳐야 찬다 3, 무쇠소녀단 (8개)
3. **🌟 STAR (팬덤/오디션)** - 미스터트롯3, 현역가왕2, 프로젝트 7, 유니버스 리그, 쇼미더머니, 싱어게인, 랩:퍼블릭 (7개)

**UI/UX 특징:**
- 메뉴 버튼: 기본 한글(로맨스) → 클릭 시 영어(LOVE)로 토글
- 모바일: 이모지 숨김, 텍스트만 표시
- 데스크톱: 이모지 + 텍스트
- 드롭다운: 헤더 없이 방송명만 깔끔하게 표시
- 부드러운 애니메이션과 외부 클릭 감지

**동작:**
- "나는 SOLO" 클릭 → 메인 페이지로 이동
- 나머지 프로그램 → 허수 (에러 없이 드롭다운만 닫힘)

**파일:**
- `lib/constants/shows.ts` - 프로그램 데이터 정의
- `components/c-common/ShowMenu.tsx` - 드롭다운 메뉴 컴포넌트
- `components/c-layout/AppHeader.tsx` - 헤더에 3개 메뉴 추가


<6> 미션 카드 그리드 레이아웃 변경 (리얼 캐스팅 대비)

**변경 사유:**
추후 진행될 '리얼 캐스팅' 프로젝트에서 유튜버 딜러들의 썸네일을 효과적으로 보여주기 위해 미리 공간을 확보했습니다.

**변경 내용:**
- **PC 그리드:** 3열 → 2열로 변경하여 카드 크기를 키웠습니다.
- **첫 줄 HOT 미션:** 전체 너비를 사용하여 임팩트를 주었습니다.
- **나머지 미션:** 2개씩 한 줄에 배치하여 가독성을 높였습니다.
- **모바일:** 1열 유지를 통해 모바일 사용성을 해치지 않았습니다.

**수정 파일:**
- `app/page.tsx` - 메인 페이지 그리드
- `app/p-missions/page.tsx` - 미션 목록 페이지 그리드


<7> 미션 데이터 DB 연동 및 표시 정상화

**문제 상황:**
- 기존에 Mock Data(가짜 데이터)로 보여주던 미션들을 실제 Supabase DB(`t_missions1`, `t_missions2`)와 연동하는 과정에서 데이터가 보이지 않거나 에러가 발생함.
- "진행 중인 미션이 없습니다" 문구만 표시됨.
- `PGRST201` (중복 관계) 에러 발생.

**해결 내용:**
1. **DB 보안 정책(RLS) 설정:**
   - Supabase 테이블(`t_missions1`, `t_missions2`, `t_users`)이 기본적으로 잠겨있어 데이터 조회가 불가능했습니다.
   - `ENABLE ROW LEVEL SECURITY` 및 `SELECT` 정책을 추가하여 누구나 미션과 작성자 정보를 조회할 수 있도록 잠금을 해제했습니다.

2. **외래키(Foreign Key) 관계 명시:**
   - `t_missions1`과 `t_users` 사이에 관계가 2개 이상 존재하여(작성자, 수정자 등) Supabase가 어떤 관계를 써야 할지 몰라 에러(`PGRST201`)가 발생했습니다.
   - 코드에서 `.select("*, creator:t_users!fk_missions1_creator(...)")`와 같이 **사용할 외래키 제약조건 이름**을 명시적으로 지정하여 해결했습니다.

3. **런타임 에러 수정:**
   - "미션 게시하기" 버튼 클릭 시 `TypeError: onMissionModalOpen is not a function` 에러가 발생했습니다.
   - `SidebarNavigation` 컴포넌트에 필요한 함수(`onMissionModalOpen` 등)가 props로 전달되지 않아 발생한 문제였으며, 이를 연결하여 해결했습니다.

4. **실제 데이터 연동:**
   - `getMissions`, `getMissions2` 함수가 이제 실제 DB에서 데이터를 가져오며, 작성자 정보(닉네임, 티어)도 `t_users` 테이블과 조인하여 정상적으로 표시됩니다.
   - '내 픽 보기' 모달도 실제 투표 데이터(`t_pickresult1`, `t_pickresult2`)를 조회하도록 수정했습니다.

**결과:**
- 메인 화면에 DB에 저장된 미션들이 정상적으로 표시됩니다.
- 미션 카드에 작성자 닉네임과 티어가 올바르게 나옵니다.
- 에러 없이 미션 게시 및 조회 기능이 작동합니다.


<8> 미션 UI 개선 및 이미지 업로드 기능 구현

**목표:**
미션 상세 페이지의 정보 전달력을 높이고, 필요시 참고 이미지를 추가할 수 있도록 기능을 보완했습니다.

**구현 내용:**
1. **미션 상세 UI 개선 (`MatchVotePage`, `SubjectiveVotePage`)**
   - **"더보기" 기능:** 미션 설명이 길 경우 자동으로 접히고, "더보기" 버튼을 통해 전체 내용을 확인할 수 있도록 개선했습니다.
   - **이미지 및 링크 표시:** 미션에 첨부된 참고 이미지와 영상 URL이 투표 페이지에 바로 표시되도록 수정했습니다.
   - **상태 관리:** `isExpanded` 상태를 추가하여 UI 인터랙션을 부드럽게 처리했습니다.

2. **미션 생성 시 참고 이미지 업로드**
   - **기능 정의:** 썸네일 설정과는 별개로, **상세 페이지 본문에 보여질 참고용(레퍼런스) 이미지**를 업로드하는 기능입니다.
   - **구현:** Supabase Storage를 연동하여 실제 이미지 파일을 업로드할 수 있게 만들었습니다.
   - **썸네일 정책 유지:** 리스트에 보이는 썸네일은 기존 정책대로 **입력한 영상 URL에서 자동으로 추출**됩니다. 업로드한 이미지는 상세 페이지 설명 보완용으로만 사용되어 역할이 섞이지 않도록 했습니다.

**결과:**
- 딜러는 영상 URL만 넣으면 썸네일이 자동 세팅되어 편리합니다.
- 추가 설명이 필요할 때만 이미지를 업로드하여 상세 페이지를 풍부하게 만들 수 있습니다.


<9> 리얼 캐스팅(유튜버 딜러) 운영 및 관리 이슈

**중요 이슈:**
유튜버 딜러들이 참여하는 '리얼 캐스팅'은 단순한 기능 추가를 넘어 운영 정책이 매우 중요합니다.

1. **방청 및 필터링 (Quality Control):**
   - 딜러들이 올리는 미션의 퀄리티를 어떻게 보장할 것인가?
   - 부적절한 콘텐츠나 썸네일에 대한 필터링 기준과 모니터링(방청) 프로세스가 필요합니다.
   - 현재의 AI 검증 시스템을 딜러 전용으로 강화하거나, 운영자가 승인하는 절차를 고려해야 합니다.

2. **데이터 관리 방식 (DB vs 하드코딩):**
   - **결정 사항:** 리얼 캐스팅 딜러 정보는 별도의 DB 테이블을 만들지 않고, **코드 레벨(상수 파일)에서 관리**하기로 했습니다. (가볍고 빠른 적용을 위해)
   - **관리 방법:** `lib/constants/dealers.ts` 같은 파일에 딜러들의 채널 정보, 썸네일 스타일 등을 정의하여 관리합니다.

3. **모니터링 및 정보 업데이트:**
   - **문제점:** DB가 없으므로 딜러 정보가 바뀌면 코드를 수정하고 재배포해야 합니다.
   - **운영 계획:** 주기적으로(예: 주 1회) 딜러들의 활동을 모니터링하고, 변경된 정보(채널명, 프로필 등)를 코드에 반영하여 업데이트하는 프로세스가 필요합니다.
   - 추후 딜러가 급증하면 관리자 페이지 도입을 재검토하겠지만, 초기 단계에서는 **주기적인 모니터링과 코드 업데이트**로 대응하는 것이 효율적입니다.
